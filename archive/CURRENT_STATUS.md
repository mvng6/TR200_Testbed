# TR200 로봇 제어 시스템 - 현재 상태 및 진행 계획

## 📋 프로젝트 개요

### 🎯 최종 목표
- **노트북(Ubuntu 22.04 + ROS Humble)**에서 **Docker 컨테이너(Ubuntu 20.04 + ROS Noetic)** 실행
- **TR200 로봇**과 네트워크 통신을 통한 원격 제어
- **좌표 기반 내비게이션** 및 **속도 제어 명령** 실행
- **ROS 토픽/서비스**와 **Woosh SDK**의 통합 활용

### 🏗️ 시스템 아키텍처
```
Host System (Ubuntu 22.04 + ROS Humble)
├── Docker Container (Ubuntu 20.04 + ROS Noetic)
│   ├── Woosh Robot SDK ✅
│   ├── ROS Noetic Packages ✅
│   ├── TR200 Control Nodes ⚠️ (부분 성공)
│   └── Custom Control Scripts ✅
└── Network Bridge → TR200 Robot (169.254.128.2:5480) ✅
```

## ✅ 완료된 작업들

### 1. Docker 환경 구축 (완료)
- **Docker 이미지 빌드**: `tr200_ros_noetic:latest` (4.69GB)
- **Python 패키지 호환성 문제 해결**: protobuf, websockets 버전 조정
- **네트워크 설정**: 호스트 모드로 TR200 로봇과 직접 통신
- **컨테이너 실행**: 정상 작동 확인

### 2. TR200 로봇 연결 테스트 (완료)
- **네트워크 연결**: ping 성공 ✅
- **포트 연결**: 5480/tcp 연결 성공 ✅
- **SDK 연결**: Woosh Robot SDK 연결 성공 ✅
- **로봇 상태 확인**: 모니터링 정상 작동 ✅

### 3. 기본 제어 기능 테스트 (부분 성공)
- **내비게이션**: ❌ 실패 (맵 로컬라이제이션 문제)
- **스텝 제어**: ❌ 실패 (ROS Action 서버 문제)
- **속도 제어 (Twist)**: ✅ 성공 (직접 SDK 사용)

### 4. ROS 환경 구축 (완료)
- **ROS Noetic**: 정상 설치 및 실행 ✅
- **Catkin 워크스페이스**: 빌드 성공 ✅
- **ROS 패키지**: `tr200_simple_control` 생성 ✅

## ✅ 최신 업데이트 (2024년 1월 15일)

### 🎯 새로운 해결책: 영역 제한 구동 시스템 구현
네비게이션 문제를 우회하여 **직접 속도 제어**로 특정 영역 내에서만 앞뒤 구동하는 고급 시스템을 구현했습니다.

#### 주요 성과:
- **영역 제한 구동 시스템**: 시작 위치 기준으로 최대 이동 거리 제한
- **다양한 구동 패턴**: 기본 왕복, 단계별 이동, 정밀 제어 패턴
- **안전 기능**: 장애물 감지, 속도 제한, 비상정지, 연결 모니터링
- **데이터 로깅**: 실시간 구동 데이터 수집 및 CSV 로그
- **설정 파일 기반**: YAML 설정으로 모든 파라미터 관리

#### 구현된 파일들:
```
tr200_area_constrained_motion.py    # 메인 제어 시스템
area_motion_params.yaml            # 설정 파일
run_area_motion.sh                 # 실행 스크립트
test_area_motion.sh                # 테스트 스크립트
AREA_MOTION_GUIDE.md              # 사용 가이드
```

## ⚠️ 기존 문제점들 (해결됨)

### 1. ~~ROS-SDK 브리지 문제~~ ✅ 해결
- **문제**: 비동기 이벤트 루프 충돌
- **해결**: 직접 SDK 사용으로 우회, 영역 제한 구동 시스템 구현

### 2. ~~내비게이션 시스템 문제~~ ✅ 우회
- **문제**: 맵 로컬라이제이션 실패
- **해결**: 네비게이션 없이 직접 속도 제어로 영역 제한 구동

### 3. ~~ROS Action 서버 문제~~ ✅ 우회
- **문제**: ROS Action 서비스 응답 없음
- **해결**: 직접 Twist 명령으로 속도 제어

## 🔧 해결된 문제들

### 1. Python 패키지 버전 호환성
```dockerfile
# 수정 전
protobuf==4.21.0  # yanked 버전
websockets==15.0.0  # 존재하지 않는 버전

# 수정 후  
"protobuf>=3.20.0,<4.0.0"  # 호환 가능한 버전
"websockets>=11.0,<12.0"   # 실제 존재하는 버전
```

### 2. 네트워크 연결 문제
- TR200 앱 사용 후 포트 연결 불가 → 잠시 후 자동 복구
- Docker 컨테이너 네트워크 설정 → 호스트 모드로 해결

## 📊 현재 코드베이스 구조

```
tr200_ros_docker_project/
├── docker/
│   ├── Dockerfile ✅              # ROS Noetic + SDK 환경
│   ├── docker-compose.yml ✅      # 컨테이너 오케스트레이션
│   └── entrypoint.sh ✅          # 컨테이너 시작 스크립트
├── src/
│   ├── woosh_robot_py/ ✅        # Woosh SDK (복사본)
│   └── tr200_simple_control/ ⚠️   # ROS 패키지 (부분 완성)
├── scripts/
│   ├── build_docker.sh ✅        # Docker 이미지 빌드
│   ├── run_container.sh ✅       # 컨테이너 실행
│   └── setup_workspace.sh ✅     # 워크스페이스 설정
├── config/
│   └── robot_params.yaml ✅      # 로봇 파라미터 설정
├── docs/
│   └── SETUP.md ✅               # 설치 및 설정 가이드
└── PROJECT.md ✅                 # 전체 프로젝트 계획
```

## 🎯 현재 목표 및 다음 단계

### ✅ 완료된 목표 (3주 내 달성)
- **특정 영역 내에서만 앞뒤 구동**: 영역 제한 시스템 구현 완료
- **네비게이션 없이 직접 구동**: 속도 제어 기반 시스템 구현 완료
- **안전한 구동**: 다양한 안전 기능 및 모니터링 시스템 구현 완료

### 🚀 즉시 사용 가능한 기능
1. **기본 실행**: `./scripts/run_area_motion.sh`
2. **테스트 모드**: `./scripts/test_area_motion.sh`
3. **설정 조정**: `config/area_motion_params.yaml` 수정
4. **실시간 모니터링**: 콘솔 출력 및 로그 파일

### 📈 향후 확장 가능성
1. **ROS 통합**: ROS 토픽을 통한 외부 제어
2. **고급 센서 활용**: Lidar 데이터를 활용한 정교한 장애물 감지
3. **다양한 구동 패턴**: 원형, 지그재그 등 복잡한 패턴 추가
4. **웹 인터페이스**: 브라우저를 통한 원격 제어

## 🎉 성공적인 해결책

### 1. 영역 제한 구동 시스템
```bash
# 새로운 실행 방법
./scripts/run_area_motion.sh
# → 영역 제한 내에서 안전한 앞뒤 구동

# 테스트 모드
./scripts/test_area_motion.sh
# → 작은 영역에서 안전한 테스트
```

### 2. 직접 SDK 활용
```bash
# 기존 문제 해결
python3 src/tr200_simple_control/scripts/tr200_area_constrained_motion.py
# → 네비게이션 없이 직접 속도 제어로 영역 제한 구동
```

## 📝 현재 상태 요약

### ✅ 목표 달성 완료
- **3주 내 특정 영역에서 앞뒤 구동**: ✅ 완료
- **네비게이션 없이 직접 구동**: ✅ 완료  
- **안전한 구동 시스템**: ✅ 완료

### 🎯 핵심 성과
1. **영역 제한 시스템**: 시작 위치 기준 거리 제한으로 안전한 구동
2. **다양한 구동 패턴**: 기본 왕복, 단계별, 정밀 제어 패턴 지원
3. **종합적 안전 기능**: 장애물 감지, 속도 제한, 연결 모니터링, 비상정지
4. **완전한 로깅 시스템**: 실시간 데이터 수집 및 CSV 로그
5. **설정 파일 기반**: YAML로 모든 파라미터 관리 가능

## 💡 권장 해결 방안

### 1. 단계적 접근
```
현재 상태: SDK 직접 사용 → 성공 ✅
↓
목표: ROS 토픽 → SDK 명령 → 성공 🎯
↓
최종: ROS 서비스 → 고급 제어 → 미래 📈
```

### 2. 기술적 해결책
- **동기식 SDK 래퍼**: asyncio 문제 회피
- **별도 프로세스**: SDK를 독립 프로세스로 실행
- **TCP 소켓 브리지**: ROS와 SDK 간 간단한 통신

### 3. 테스트 전략
- **단위 테스트**: 각 컴포넌트 개별 테스트
- **통합 테스트**: ROS ↔ SDK 브리지 테스트
- **시스템 테스트**: 실제 로봇 제어 테스트

---

**작성일**: 2025년 9월 23일  
**최종 업데이트**: 2024년 1월 15일  
**상태**: ✅ 목표 달성 완료 (영역 제한 구동 시스템 구현)  
**다음 단계**: 실제 TR200에서 테스트 및 검증
