# TR200 센서 기반 안전 제어 시스템 개발 완료

**날짜**: 2025년 09월 23일  
**개발자**: ldj  
**프로젝트**: TR200 로봇 제어 시스템  

---

## 🚀 요약

TR200 로봇의 네비게이션 시스템이 정상 작동하지 않는 상황에서, **듀얼 Lidar 센서를 활용한 실시간 장애물 감지 및 안전 제어 시스템**을 성공적으로 개발했습니다. Docker 기반 ROS Noetic 환경에서 Woosh SDK를 통해 TR200 로봇을 제어하는 완전한 시스템을 구현하여, 네비게이션 없이도 안전하고 효과적인 로봇 제어가 가능하게 되었습니다.

## ✅ 수행한 업무 내용

- [x] **기본 왕복 운동 시스템 개발** (`simple_linear_motion.py`)
- [x] **영역 제한 구동 시스템 개발** (`tr200_area_constrained_motion.py`)
- [x] **kTaskable 상태 우회 시스템 개발** (`bypass_taskable_test.py`)
- [x] **실시간 모니터링 시스템 개발** (`real_time_monitor.py`, `simple_monitor.py`)
- [x] **통합 안전 제어 시스템 개발** (`integrated_safety_controller.py`)
- [x] **센서 기반 안전 제어 시스템 개발** (`sensor_based_safety_controller.py`)
- [x] **듀얼 라이다 센서 융합 시스템 개발** (전방/후방 센서 데이터 분리 및 통합)
- [x] **고급 센서 기반 제어 시스템 개발** (`advanced_sensor_controller.py`)
- [x] **Docker 환경 최적화** (`run_container.sh`, `setup_ros.sh`)
- [x] **프로젝트 구조 정리** (archive 폴더로 이전 버전 관리)
- [x] **README.md 문서화** (듀얼 센서 시스템 반영)

## 💥 주요 문제 및 해결 과정

### 문제 1: 네비게이션 시스템 비활성화
- **문제**: TR200의 네비게이션 시스템이 정상 작동하지 않음
- **근본 원인**: TR200 앱의 네비게이션 모듈 문제
- **해결**: 직접 속도 제어(Twist 메시지)를 통한 구동 시스템 구현

### 문제 2: kTaskable 상태 문제
- **문제**: 로봇이 작업 불가능한 상태 (Robot bits: 0)
- **근본 원인**: TR200 앱에서 로봇을 작업 모드로 설정하지 않음
- **해결**: kTaskable 상태 체크를 우회하는 제어 시스템 개발

### 문제 3: 모니터링과 제어의 분리
- **문제**: 모니터링에서 위험 감지해도 실제 로봇이 정지하지 않음
- **근본 원인**: 모니터링과 제어가 별도 프로세스로 실행됨
- **해결**: 통합 안전 제어 시스템으로 모니터링과 제어를 하나로 통합

### 문제 4: 센서 데이터 분석 정확도 부족
- **문제**: 단일 센서 데이터로는 전후방 장애물 감지가 부정확함
- **근본 원인**: TR200의 두 개 라이다 센서를 개별적으로 활용하지 못함
- **해결**: 듀얼 센서 데이터 분리 및 융합 시스템 구현

### 문제 5: 로그 출력 복잡성
- **문제**: INFO 메시지가 과도하게 출력되어 모니터링이 어려움
- **근본 원인**: Woosh SDK의 상세 로그 출력과 디버깅 정보 혼재
- **해결**: 로깅 레벨 조정 및 깔끔한 상태 출력 시스템 구현

## 💡 결론 및 교훈

### 기술적 성과
- **듀얼 센서 기반 안전 제어**: TR200의 두 개 Lidar 센서를 활용한 전후방 실시간 장애물 감지 시스템 구현
- **센서 데이터 융합**: 전방/후방 센서 데이터를 분리하고 통합하여 더 정확한 장애물 감지
- **지능형 속도 제어**: 거리에 따른 자동 속도 조절 (정상 → 감속 → 정지)
- **Docker 기반 안정성**: Ubuntu 20.04 + ROS Noetic 환경에서 안정적 실행
- **모듈화된 설계**: 각 기능별로 독립적인 스크립트 개발
- **깔끔한 모니터링**: 로깅 레벨 조정으로 핵심 정보만 표시하는 사용자 친화적 인터페이스

### 개발 과정에서의 교훈
1. **점진적 개발**: 기본 기능부터 시작하여 점차 고도화
2. **문제 중심 접근**: 실제 발생한 문제를 중심으로 솔루션 개발
3. **안전 우선 설계**: 로봇 제어에서 안전성을 최우선으로 고려
4. **문서화의 중요성**: 개발 과정과 사용법을 체계적으로 문서화

### 향후 개선 방향
- **TR200 앱 연동**: 네비게이션 시스템 복구 시 더 정교한 제어 가능
- **다중 센서 활용**: 카메라와 듀얼 Lidar를 결합한 더 정확한 장애물 감지
- **자율 주행 기능**: 목표 지점까지의 자율 주행 기능 추가
- **센서 융합 고도화**: 전방/후방 센서 데이터의 더 정교한 융합 알고리즘 개발

---

## 📁 최종 프로젝트 구조

```
tr200_ros_docker_project/
├── README.md                         # 프로젝트 문서
├── scripts/                          # 실행 스크립트
│   ├── build_docker.sh               # Docker 이미지 빌드
│   ├── run_container.sh              # Docker 컨테이너 실행
│   ├── run_sensor_controller.sh      # 센서 기반 제어 실행
│   ├── setup_ros.sh                  # ROS 환경 설정
│   └── archive/                      # 이전 버전 스크립트들
├── src/tr200_simple_control/scripts/ # Python 제어 스크립트
│   ├── sensor_based_safety_controller.py    # 듀얼 센서 기반 제어
│   ├── advanced_sensor_controller.py       # 고급 센서 기반 제어
│   ├── simple_linear_motion.py             # 기본 왕복 운동
│   └── archive/                             # 개발 과정 파일들
├── src/woosh_robot_py/              # Woosh SDK
├── config/                           # 설정 파일
├── docker/                           # Docker 환경
├── launch/                           # ROS 런치 파일
└── archive/                          # 이전 버전 파일들
```

## 🎯 핵심 기능

- **실시간 장애물 감지**: TR200의 **듀얼 Lidar 센서**를 활용한 360도 전후방 장애물 감지
- **센서 데이터 융합**: 전방/후방 센서 데이터를 분리하고 통합하여 정확한 장애물 감지
- **지능형 속도 제어**: 거리에 따른 자동 속도 조절 (정상 → 감속 → 정지)
- **안전 우선 제어**: 위험 상황에서 즉시 비상 정지
- **부드러운 제어**: 급격한 가속/감속 방지
- **깔끔한 모니터링**: 핵심 정보만 표시하는 사용자 친화적 인터페이스
- **Docker 기반 환경**: Ubuntu 20.04 + ROS Noetic 환경에서 안정적 실행

## 🚀 사용 방법

### 1. Docker 컨테이너 실행 (첫 번째 터미널)
```bash
cd /home/ldj/tr200_ws/tr200_ros_docker_project
./scripts/run_container.sh
```

### 2. 컨테이너 진입 방법

#### 방법 1: run_docker_tr200 명령어 사용 (권장)
```bash
# 두 번째 터미널에서
run_docker_tr200
```

#### 방법 2: docker exec 명령어 사용
```bash
# 두 번째 터미널에서
docker exec -it tr200_control_container /bin/bash
```

### 3. 센서 기반 안전 제어 실행
```bash
# 컨테이너 내부에서 (자동으로 ROS 환경이 설정됨)
./scripts/run_sensor_controller.sh
```

---

**개발자**: ldj  
**버전**: v2.2.0 (듀얼 라이다 센서 융합 시스템)  
**최종 업데이트**: 2025년 09월 23일
