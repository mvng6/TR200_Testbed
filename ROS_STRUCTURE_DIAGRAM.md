# TR200 ROS 제어 시스템 구조도

## 🏗️ 전체 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                        ROS 환경                                  │
├─────────────────────────────────────────────────────────────────┤
│  ROS Master (관리사무소)                                         │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │  tr200_sensor_safety_controller 노드                        │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐ │ │
│  │  │ 센서 데이터        │  │ 안전 로직         │  │ 속도 제어   │ │ │
│  │  │ 처리             │  │  분석            │  │ 결정        │ │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────┘ │ │
│  └─────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│  ROS 토픽 (메시지 통신)                                             │
│  /scan ←→ /safety_status ←→ /obstacle_distance ←→ /robot_state  │
├─────────────────────────────────────────────────────────────────┤
│  ROS 서비스 (요청-응답)                                            │
│  /set_safety_params ←→ /emergency_stop                          │
└─────────────────────────────────────────────────────────────────┘
                                ↕
┌─────────────────────────────────────────────────────────────────┐
│                    Woosh SDK 브리지                              │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │  WebSocket 통신 (비동기)                                       │ │
│  │  ScannerData ←→ Twist ←→ RobotControl                       │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                                ↕
┌─────────────────────────────────────────────────────────────────┐
│                      TR200 로봇 하드웨어                           │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │ 전방 라이다       │  │ 후방 라이다       │  │ 모터 제어          │  │
│  │ 센서            │   │ 센서            │  │ 시스템             │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

## 🔄 데이터 흐름

### 1. 센서 데이터 수신
```
TR200 라이다 → Woosh SDK → ROS 노드 → LaserScan 메시지 → RViz 시각화
```

### 2. 안전 제어 결정
```
센서 데이터 → 장애물 분석 → 안전 상태 판단 → 속도 결정 → 로봇 제어
```

### 3. 외부 제어 수신
```
외부 ROS 노드 → /external_cmd_vel → ROS 노드 → 로봇 제어
```

### 4. 상태 모니터링
```
ROS 노드 → ROS 토픽 → 모니터링 도구 (rostopic, rqt 등)
```

## 📊 ROS 토픽 및 서비스 상세

### 퍼블리시 토픽 (정보 제공)
- `/scan` (LaserScan): 라이다 센서 데이터
- `/safety_status` (String): 안전 상태 ("🟢 안전", "🟡 주의", "🔴 위험")
- `/obstacle_distance` (Float32): 최소 장애물 거리
- `/emergency_stop` (Bool): 비상 정지 상태
- `/robot_state` (String): 로봇 상태 정보

### 서브스크라이브 토픽 (명령 수신)
- `/external_cmd_vel` (Twist): 외부 속도 명령

### 서비스 (요청-응답)
- `/set_safety_params`: 안전 파라미터 동적 변경
- `/emergency_stop`: 비상 정지 제어

## 🛠️ 개발 및 실행 과정

### 1. 개발 단계
```
코드 작성 → 파일 구조 설정 → 빌드 → 테스트 → 배포
```

### 2. 실행 단계
```
ROS Master 시작 → 노드 실행 → 통신 시작 → 로봇 제어
```

### 3. 모니터링 단계
```
상태 확인 → 로그 분석 → 성능 측정 → 문제 해결
```
